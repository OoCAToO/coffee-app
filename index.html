<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Barista Wrist Pro</title>
    <!-- PWA 支援：讓你可以將網頁「安裝」到桌面 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            background-color: #000; 
            color: #fff; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
        }
        /* 模擬手錶錶盤容器 */
        .watch-container {
            width: 100vw;
            height: 100vw;
            max-width: 320px;
            max-height: 320px;
            border-radius: 50%;
            border: 4px solid #1a1a1a;
            margin: 5vh auto;
            position: relative;
            overflow: hidden;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 50px rgba(249, 115, 22, 0.15);
        }
        .scroll-area {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            padding: 45px 20px;
            text-align: center;
            scrollbar-width: none;
        }
        .scroll-area::-webkit-scrollbar { display: none; }
        
        .btn-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #111;
            border: 1px solid #333;
            transition: all 0.1s;
        }
        .btn-circle:active { transform: scale(0.9); background: #222; border-color: #f97316; }
        
        .list-item {
            background: #0a0a0a;
            padding: 12px;
            border-radius: 14px;
            margin-bottom: 8px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            font-size: 11px;
            border: 1px solid #1a1a1a;
        }
        
        .method-btn {
            background: #0a0a0a;
            padding: 12px 16px;
            border-radius: 18px;
            margin-bottom: 8px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 13px;
            border: 1px solid #1a1a1a;
        }
        .method-btn:active { border-color: #f97316; background: #111; }

        .toggle-tab {
            background: #111;
            padding: 3px;
            border-radius: 20px;
            display: inline-flex;
            margin-bottom: 10px;
            border: 1px solid #222;
        }
        .toggle-btn {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 10px;
            color: #555;
            transition: 0.2s;
        }
        .toggle-btn.active {
            background: #f97316;
            color: #fff;
        }

        /* 針對真正的圓形手錶優化 */
        @media (max-width: 280px) {
            .watch-container { border: none; margin: 0; border-radius: 0; max-width: 100%; max-height: 100%; height: 100vh; }
        }
    </style>
</head>
<body>

    <div id="app">
        <div class="watch-container" id="screen">
            <!-- 頁面 1: 主選單 -->
            <div id="home-page" class="scroll-area">
                <div class="text-orange-500 text-[10px] font-black mb-3 tracking-[0.2em] uppercase italic">Barista Wrist</div>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="router('method')" class="bg-zinc-900/50 p-3 rounded-2xl flex flex-col items-center active:border-orange-500 border border-transparent">
                        <span class="text-xl">☕</span>
                        <span class="text-[10px] mt-1 text-zinc-300">選器具</span>
                    </button>
                    <button onclick="router('calc')" class="bg-zinc-900/50 p-3 rounded-2xl flex flex-col items-center active:border-orange-500 border border-transparent">
                        <span class="text-xl">⚖️</span>
                        <span class="text-[10px] mt-1 text-zinc-300">雙向計算</span>
                    </button>
                    <button onclick="router('timer')" class="bg-zinc-900/50 p-3 rounded-2xl flex flex-col items-center active:border-orange-500 border border-transparent">
                        <span class="text-xl">⏱️</span>
                        <span class="text-[10px] mt-1 text-zinc-300">計時器</span>
                    </button>
                    <button onclick="router('grind')" class="bg-zinc-900/50 p-3 rounded-2xl flex flex-col items-center active:border-orange-500 border border-transparent">
                        <span class="text-xl">⚙️</span>
                        <span class="text-[10px] mt-1 text-zinc-300">研磨度</span>
                    </button>
                </div>
            </div>

            <!-- 頁面 2: 器具選擇 -->
            <div id="method-page" class="scroll-area hidden">
                <button onclick="router('home')" class="text-zinc-600 text-[10px] mb-3 block mx-auto font-bold uppercase tracking-widest">CLOSE</button>
                <div id="method-list" class="space-y-1"></div>
            </div>

            <!-- 頁面 3: 雙向計算器 -->
            <div id="calc-page" class="scroll-area hidden">
                <button onclick="router('home')" class="text-zinc-600 text-[10px] mb-2 font-bold uppercase tracking-widest">CLOSE</button>
                
                <div class="toggle-tab">
                    <button id="mode-coffee" onclick="setCalcMode('coffee')" class="toggle-btn active">以粉為主</button>
                    <button id="mode-water" onclick="setCalcMode('water')" class="toggle-btn">以水為主</button>
                </div>

                <div class="mb-2">
                    <div id="input-label" class="text-[9px] text-zinc-500 uppercase tracking-widest">Coffee (g)</div>
                    <div class="flex items-center justify-center space-x-5 my-1">
                        <button onclick="adjustValue(-1)" class="text-3xl text-orange-500 w-8 active:opacity-50">－</button>
                        <span id="main-val" class="text-4xl font-bold tabular-nums">15</span>
                        <button onclick="adjustValue(1)" class="text-3xl text-orange-500 w-8 active:opacity-50">＋</button>
                    </div>
                </div>

                <div class="h-px bg-zinc-800 w-16 mx-auto my-2"></div>
                
                <div id="result-label" class="text-[9px] text-zinc-500 uppercase tracking-widest">Target Water (ml)</div>
                <div id="result-val" class="text-3xl font-bold text-blue-500 tabular-nums">225</div>
                <div id="calc-method-tag" class="text-[9px] text-zinc-600 mt-2 italic font-serif">V60 (1:15)</div>
            </div>

            <!-- 頁面 4: 計時器 -->
            <div id="timer-page" class="scroll-area hidden">
                <button onclick="router('home')" class="text-zinc-600 text-[10px] mb-2 font-bold uppercase tracking-widest">CLOSE</button>
                <div class="flex justify-between px-3 text-[9px] text-zinc-500 mb-2">
                    <span id="timer-target" class="tabular-nums">總水：225ml</span>
                    <span id="timer-bloom" class="text-orange-400 font-bold tabular-nums">悶蒸：30ml</span>
                </div>
                <div id="timer-display" class="text-5xl font-mono font-bold mb-1 tracking-tighter tabular-nums text-white">00:00</div>
                <div id="phase-text" class="text-[11px] font-bold text-orange-500 h-5 mb-4 uppercase tracking-wider">Ready</div>
                <div class="flex justify-center space-x-4">
                    <button id="timer-btn" onclick="toggleTimer()" class="btn-circle text-green-500 text-2xl">▶</button>
                    <button onclick="resetTimer()" class="btn-circle text-zinc-600 text-2xl">↺</button>
                </div>
            </div>

            <!-- 頁面 5: 研磨度與烘焙度 -->
            <div id="grind-page" class="scroll-area hidden text-left px-4">
                <button onclick="router('home')" class="text-zinc-600 text-[10px] mb-3 block mx-auto font-bold uppercase tracking-widest">CLOSE</button>
                
                <div class="toggle-tab mx-auto flex justify-center w-full mb-4">
                    <button id="roast-light" onclick="setRoast('light')" class="toggle-btn flex-1">淺</button>
                    <button id="roast-medium" onclick="setRoast('medium')" class="toggle-btn active flex-1">中</button>
                    <button id="roast-dark" onclick="setRoast('dark')" class="toggle-btn flex-1">深</button>
                </div>

                <div id="grind-list" class="space-y-2"></div>
                <div class="h-10"></div> <!-- 底部緩衝 -->
            </div>
        </div>
    </div>

    <script>
        // --- 核心數據 ---
        const methods = [
            { id: 'moka', name: '摩卡壺', ratio: 7, baseGrind: '極細', desc: '精鹽' },
            { id: 'v60', name: 'V60 手沖', ratio: 15, baseGrind: '中細', desc: '砂糖' },
            { id: 'syphon', name: '賽風壺', ratio: 12, baseGrind: '中細', desc: '砂糖' },
            { id: 'aeropress', name: '愛樂壓', ratio: 13, baseGrind: '中', desc: '細砂糖' },
            { id: 'french', name: '法壓壺', ratio: 12, baseGrind: '粗', desc: '海鹽' }
        ];

        let currentMethod = methods[1]; 
        let calcMode = 'coffee'; 
        let coffeeWeight = 15;
        let waterWeight = 225;
        let roastLevel = 'medium'; 
        let seconds = 0;
        let timerId = null;

        // --- 初始化 ---
        function init() {
            renderMethods();
            renderGrind();
            renderCalc();
        }

        // --- 導覽系統 ---
        function router(page) {
            const pages = ['home-page', 'method-page', 'calc-page', 'timer-page', 'grind-page'];
            pages.forEach(p => {
                const el = document.getElementById(p);
                el.classList.add('hidden');
                el.scrollTop = 0; // 每次進入頁面回到頂部
            });
            document.getElementById(page + '-page').classList.remove('hidden');
            
            if(page === 'timer') {
                document.getElementById('timer-target').innerText = `總水：${waterWeight}ml`;
                document.getElementById('timer-bloom').innerText = `悶蒸：${Math.round(coffeeWeight * 2)}ml`;
            }
        }

        // --- 器具頁面 ---
        function renderMethods() {
            const list = document.getElementById('method-list');
            list.innerHTML = '';
            methods.forEach(m => {
                const btn = document.createElement('button');
                btn.className = 'method-btn';
                btn.onclick = () => {
                    currentMethod = m;
                    syncValues();
                    renderCalc();
                    router('calc');
                    vibrate(20);
                };
                btn.innerHTML = `<span>${m.name}</span><span class="text-[10px] text-zinc-600 font-mono">1:${m.ratio}</span>`;
                list.appendChild(btn);
            });
        }

        // --- 計算器頁面 ---
        function setCalcMode(mode) {
            calcMode = mode;
            document.getElementById('mode-coffee').classList.toggle('active', mode === 'coffee');
            document.getElementById('mode-water').classList.toggle('active', mode === 'water');
            renderCalc();
            vibrate(10);
        }

        function adjustValue(delta) {
            if (calcMode === 'coffee') {
                coffeeWeight = Math.max(1, coffeeWeight + delta);
                waterWeight = Math.round(coffeeWeight * currentMethod.ratio);
            } else {
                waterWeight = Math.max(10, waterWeight + (delta * 5));
                coffeeWeight = parseFloat((waterWeight / currentMethod.ratio).toFixed(1));
            }
            renderCalc();
            vibrate(5);
        }

        function syncValues() {
            if (calcMode === 'coffee') {
                waterWeight = Math.round(coffeeWeight * currentMethod.ratio);
            } else {
                coffeeWeight = parseFloat((waterWeight / currentMethod.ratio).toFixed(1));
            }
        }

        function renderCalc() {
            document.getElementById('input-label').innerText = calcMode === 'coffee' ? "Coffee (g)" : "Water (ml)";
            document.getElementById('result-label').innerText = calcMode === 'coffee' ? "Target Water (ml)" : "Needed Coffee (g)";
            document.getElementById('main-val').innerText = calcMode === 'coffee' ? coffeeWeight : waterWeight;
            document.getElementById('result-val').innerText = calcMode === 'coffee' ? waterWeight : coffeeWeight;
            document.getElementById('calc-method-tag').innerText = `${currentMethod.name} (1:${currentMethod.ratio})`;
        }

        // --- 研磨度頁面 ---
        function setRoast(level) {
            roastLevel = level;
            ['light', 'medium', 'dark'].forEach(l => {
                document.getElementById(`roast-${l}`).classList.toggle('active', roastLevel === l);
            });
            renderGrind();
            vibrate(20);
        }

        function renderGrind() {
            const list = document.getElementById('grind-list');
            list.innerHTML = '';
            
            const roastNote = roastLevel === 'light' ? ' (微調細)' : roastLevel === 'dark' ? ' (微調粗)' : '';

            methods.forEach(m => {
                const item = document.createElement('div');
                item.className = 'list-item';
                
                let grindText = m.baseGrind;
                let descText = m.desc;

                // 烘焙度邏輯微調描述
                if (roastLevel === 'light') {
                    if (m.baseGrind === '粗') grindText = '中粗';
                } else if (roastLevel === 'dark') {
                    if (m.baseGrind === '中細') grindText = '中';
                }

                item.innerHTML = `
                    <div class="flex justify-between w-full font-bold mb-1">
                        <span class="text-zinc-200">${m.name}</span>
                        <span class="text-orange-500">${grindText}${roastNote}</span>
                    </div>
                    <div class="text-[10px] text-zinc-500 italic">對標：${descText}</div>
                `;
                list.appendChild(item);
            });
        }

        // --- 計時器頁面 ---
        function toggleTimer() {
            const btn = document.getElementById('timer-btn');
            if (timerId) {
                clearInterval(timerId);
                timerId = null;
                btn.innerHTML = '▶';
                btn.classList.replace('text-red-500', 'text-green-500');
            } else {
                btn.innerHTML = 'II';
                btn.classList.replace('text-green-500', 'text-red-500');
                timerId = setInterval(() => {
                    seconds++;
                    updateTimerDisplay();
                }, 1000);
                vibrate([20, 50]);
            }
        }

        function updateTimerDisplay() {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            document.getElementById('timer-display').innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            
            const phase = document.getElementById('phase-text');
            if (seconds > 0 && seconds <= 30) {
                phase.innerText = `BLOOM: ${Math.round(coffeeWeight * 2)}ml`;
                phase.style.color = "#f97316";
            } else if (seconds > 30) {
                phase.innerText = "POURING...";
                phase.style.color = "#3b82f6";
            }
            
            if (seconds === 30) vibrate(300);
        }

        function resetTimer() {
            clearInterval(timerId);
            timerId = null;
            seconds = 0;
            updateTimerDisplay();
            document.getElementById('phase-text').innerText = "Ready";
            document.getElementById('phase-text').style.color = "#f97316";
            const btn = document.getElementById('timer-btn');
            btn.innerHTML = '▶';
            btn.classList.replace('text-red-500', 'text-green-500');
        }

        function vibrate(p) { if(window.navigator.vibrate) window.navigator.vibrate(p); }

        init();
    </script>
</body>
</html>